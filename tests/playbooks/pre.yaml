- hosts: all
  tasks:
    - name: git config user.name
      git_config:
        name: user.name
        scope: global
        value: foo

    - name: git config user.email
      git_config:
        name: user.email
        scope: global
        value: foo@example.org

    - name: Figure out ansible/ansible branch
      set_fact:
        __branch: "{{ zuul.projects['github.com/ansible/ansible'].checkout }}"

    - name: Setup github remotes
      args:
        chdir: "{{ ansible_user_dir }}/src/github.com/ansible-network/ansible_collections.{{ collection_namespace }}.{{ collection_name }}"
      shell: "git remote set-url origin https://github.com/ansible-network/ansible_collections.{{ collection_namespace }}.{{ collection_name }}.git"

    - name: Setup git to track remote branch
      args:
        chdir: "{{ ansible_user_dir }}/src/github.com/ansible-network/ansible_collections.{{ collection_namespace }}.{{ collection_name }}"
      shell: git branch --set-upstream-to=origin/master master
      when: __branch in ['devel']

    - name: Setup git to track remote branch
      args:
        chdir: "{{ ansible_user_dir }}/src/github.com/ansible-network/ansible_collections.{{ collection_namespace }}.{{ collection_name }}"
      shell: "git branch --set-upstream-to=origin/{{ __branch }} {{ __branch }}"
      when: __branch not in ['devel']
